import{z as e}from"./vendor-amplify--Mqz53-D.js";import{u as s,a as t,L as r}from"./vendor-react-BcQzlVW4.js";import{c as a}from"./index-DdKmiHhW.js";import{f as l,a as o,E as i,g as n,h as d,i as c,T as m,P as x}from"./vendor-icons-BYRHc9LL.js";const u=()=>{var u;const{programId:p,workoutId:g,week:h}=s(),[b,f]=t.useState(null),[j,N]=t.useState(null),[w,y]=t.useState([]),[v,k]=t.useState(0),[S,C]=t.useState({}),[W,I]=t.useState(!0),[L,E]=t.useState(!1),q=parseInt(h),P=q-1;t.useEffect(()=>{A()},[p,g,h]);const A=async()=>{try{const e=await a.models.Program.get({id:p});f(e.data);const s=await a.models.Workout.get({id:g});N(s.data);const t=await a.models.Exercise.list({filter:{workoutId:{eq:g}}}),r=await Promise.all(t.data.sort((e,s)=>e.orderIndex-s.orderIndex).map(async e=>{const s=await a.models.ExerciseWeekConfig.list({filter:{exerciseId:{eq:e.id},weekNumber:{eq:q}}});let t=[];if(P>0)try{const s=await a.models.WorkoutLog.list({filter:{programId:{eq:p},workoutId:{eq:g},weekNumber:{eq:P}}});if(s.data.length>0){const r=s.data[0],l=await a.models.ExerciseLog.list({filter:{workoutLogId:{eq:r.id},exerciseId:{eq:e.id}}});if(l.data.length>0){const e=l.data[0];t=(await a.models.SetLog.list({filter:{exerciseLogId:{eq:e.id}}})).data.sort((e,s)=>e.setNumber-s.setNumber)}}}catch(r){}return{...e,weekConfig:s.data[0],previousWeekLogs:t}}));y(r);const l={};r.forEach(e=>{if(e.weekConfig){const s=e.weekConfig.workingSets||3,t=e.weekConfig.warmupSets||0;l[e.id]=[...Array.from({length:t},(e,s)=>({setNumber:s+1,weight:0,reps:0,rpe:void 0,isWarmup:!0})),...Array.from({length:s},(e,s)=>({setNumber:t+s+1,weight:0,reps:0,rpe:void 0,isWarmup:!1}))]}}),C(l)}catch(e){}finally{I(!1)}},$=(e,s,t,r)=>{C(a=>({...a,[e]:a[e].map((e,a)=>a===s?{...e,[t]:r}:e)}))},B=(e,s=!1)=>{C(t=>{const r=t[e]||[],a={setNumber:r.length+1,weight:0,reps:0,rpe:void 0,isWarmup:s};return{...t,[e]:[...r,a]}})};if(W)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(L)return e.jsxs("div",{className:"max-w-2xl mx-auto text-center py-12",children:[e.jsx(l,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Workout Complete!"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Great job finishing ",null==j?void 0:j.name]}),e.jsx(r,{to:`/program/${p}`,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors",children:"Back to Program"})]});const D=w[v],M=S[null==D?void 0:D.id]||[];return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(r,{to:`/program/${p}`,className:"flex items-center text-blue-600 hover:text-blue-800 mb-4",children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"Back to Program"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:null==j?void 0:j.name}),e.jsxs("p",{className:"text-gray-600",children:["Week ",q," • ",null==b?void 0:b.name]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Exercise ",v+1," of ",w.length]})]})]}),D&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[D.youtubeUrl?e.jsxs("a",{href:D.youtubeUrl,target:"_blank",rel:"noopener noreferrer",className:"text-2xl font-bold text-blue-600 hover:text-blue-800 flex items-center",children:[D.name,e.jsx(i,{className:"h-5 w-5 ml-2"})]}):e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:D.name}),D.weekConfig&&e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(n,{className:"h-4 w-4 mr-1"}),D.weekConfig.reps," reps"]}),D.weekConfig.restSeconds&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(d,{className:"h-4 w-4 mr-1"}),Math.floor(D.weekConfig.restSeconds/60),":",String(D.weekConfig.restSeconds%60).padStart(2,"0")," rest"]})]})]})}),D.previousWeekLogs&&D.previousWeekLogs.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(c,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsxs("span",{className:"font-medium text-blue-800",children:["Previous Week (Week ",P,")"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:D.previousWeekLogs.filter(e=>!e.isWarmup).map((s,t)=>{const r=s.weight??0,a=s.reps??0,l=s.rpe;return e.jsxs("div",{className:"bg-white rounded px-2 py-1",children:[r,"lbs × ",a," ",l&&`@ ${l}`]},t)})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Set"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Weight (lbs)"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Reps"}),e.jsx("th",{className:"text-left py-2 px-3",children:"RPE"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Actions"})]})}),e.jsx("tbody",{children:M.map((s,t)=>{var r;const a=s.weight??0,l=s.reps??0,o=s.rpe,i=s.isWarmup??!1;return e.jsxs("tr",{className:"border-b border-gray-100 "+(i?"bg-gray-50":""),children:[e.jsx("td",{className:"py-3 px-3",children:i?`W${s.setNumber}`:s.setNumber-((null==(r=D.weekConfig)?void 0:r.warmupSets)||0)}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("input",{type:"number",step:"0.5",value:0===a?"":a.toString(),onChange:e=>$(D.id,t,"weight",parseFloat(e.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("input",{type:"number",value:0===l?"":l.toString(),onChange:e=>$(D.id,t,"reps",parseInt(e.target.value)||0),className:"w-16 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("input",{type:"number",min:"1",max:"10",value:null==o?"":o.toString(),onChange:e=>$(D.id,t,"rpe",parseInt(e.target.value)||void 0),className:"w-16 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"-"})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("button",{onClick:()=>{return e=D.id,s=t,void C(t=>{const r=t[e].filter((e,t)=>t!==s);return{...t,[e]:r.map((e,s)=>({...e,setNumber:s+1}))}});var e,s},className:"p-1 text-red-500 hover:text-red-700 hover:bg-red-100 rounded transition-colors",title:"Delete Set",children:e.jsx(m,{className:"h-4 w-4"})})})]},t)})})]})}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsxs("button",{onClick:()=>B(D.id,!1),className:"flex items-center space-x-1 bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-2 rounded-md transition-colors text-sm",children:[e.jsx(x,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Working Set"})]}),e.jsxs("button",{onClick:()=>B(D.id,!0),className:"flex items-center space-x-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-md transition-colors text-sm",children:[e.jsx(x,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Warmup Set"})]})]}),(null==(u=D.weekConfig)?void 0:u.notes)&&e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Notes"}),e.jsx("p",{className:"text-yellow-700",children:D.weekConfig.notes})]}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx("button",{onClick:()=>k(Math.max(0,v-1)),disabled:0===v,className:"bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 px-4 py-2 rounded-md transition-colors",children:"Previous Exercise"}),v===w.length-1?e.jsx("button",{onClick:async()=>{try{const e=await a.models.WorkoutLog.create({programId:p,workoutId:g,weekNumber:q,completedAt:(new Date).toISOString()});for(const s of w){const t=await a.models.ExerciseLog.create({workoutLogId:e.data.id,exerciseId:s.id}),r=S[s.id]||[];for(const e of r){const s=e.weight??0,r=e.reps??0;(s>0||r>0)&&await a.models.SetLog.create({exerciseLogId:t.data.id,setNumber:e.setNumber,weight:s,reps:r,rpe:e.rpe??void 0,isWarmup:e.isWarmup??!1})}}E(!0)}catch(e){}},className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-md transition-colors",children:"Complete Workout"}):e.jsx("button",{onClick:()=>k(v+1),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors",children:"Next Exercise"})]})]})]})};export{u as default};
